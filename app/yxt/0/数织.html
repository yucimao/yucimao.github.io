<div id="游戏厅">数织</div><script src="0.js"></script>
<small>
    棋盘里隐藏着一些方块，数字表示这一行/列有几个连续的方块，根据提示猜测这些方块的位置，当整个棋盘都符合数字所示的情况，即为胜利。
    <!--在导入里输入“测试”，进入调试模式-->
</small><br><br>

<style>
    .b0{background-color:#e4e4e4;}
    .b1{background-color:#000000;}
    .b0,.b1{width:26px;height:26px;}
    .b0{color:#828282;}
    .b,.b0,.b1,.fuhe{font-size:18px;text-align:center;vertical-align:middle;}
    .fuhe{color:#04e813;}
    .caidan{margin:30px;}
    .caidan td{cursor:pointer;}
    .shuzhi{cursor:default;}
    .zixuan{width:3em}
    .xuanguan{font-size:2em;text-align:center;padding:3px 10px;border:5px solid #e9e9e9;border-radius:50px;margin:10px;}
</style><style id="测试"></style>

<div id="dy"></div>

<div id="菜单0">
    <a class="anniu" onclick="document.getElementById('菜单0').style='display:none;';document.getElementById('菜单01').style=''">闯关模式</a><br>
    <a class="anniu" onclick="document.getElementById('菜单0').style='display:none;';document.getElementById('菜单02').style=''">随机关卡</a><br>
    <a class="anniu" onclick="document.getElementById('菜单0').style='display:none;';document.getElementById('菜单03').style=''">导入</a>
</div>

<div id="菜单01" style="display:none;">
<h3 style="display:inline;">闯关模式</h3> <a onclick="document.getElementById('菜单01').style='display:none;';document.getElementById('菜单0').style=''">取消</a><br>

<a onclick="选关('教学关')" class="anniu">教学关</a><br>

<br>

<a onclick="选关('非常简单')" class="anniu">非常简单</a><br>
<a onclick="选关('简单')" class="anniu">简单</a><br>

<br>

<a onclick="选关('字符')" class="anniu">字符</a><br>

<br>

<a onclick="选关('测试')">测试</a><br>
<br>

</div>

<div id="菜单选关" style="display:none;"></div>


<div id="菜单02" style="display:none;">
<h3 style="display:inline;">随机关卡</h3> <a onclick="document.getElementById('菜单02').style='display:none;';document.getElementById('菜单0').style=''">取消</a><br>

<a class='anniu' onclick="打印(5,5,13)">5✖︎5</a><br>
<a class='anniu' onclick="打印(10,10,70)">10✖︎10 简单</a><br>
<a class='anniu' onclick="打印(10,10,50)">10✖︎10 中等</a><br>
<a class='anniu' onclick="打印(10,10,40)">10✖︎10 困难</a><br>
<a class='anniu' onclick="打印(15,15,113)">15✖︎15</a><br>
<a class='anniu' onclick="打印(20,20,200)">20✖︎20</a><br>
<br>
<b>自选难度</b>：
<input id="自选关卡1" class="zixuan">✖︎<input id="自选关卡2" class="zixuan"> <small>黑格数量:</small><input id="自选关卡3" class="zixuan"> <a onclick="自选(document.getElementById('自选关卡1').value,document.getElementById('自选关卡2').value,document.getElementById('自选关卡3').value)">确定</a>
</div>

<div id="菜单03" style="display:none;">
    <h3 style="display:inline;">导入</h3> <a onclick="document.getElementById('菜单03').style='display:none;';document.getElementById('菜单0').style=''">取消</a><br>
    <input id="导入"> <a onclick="导入(document.getElementById('导入').value)">确定</a><br>
    <a onclick="转换(document.getElementById('导入').value)">转换</a><br>
    <br>

    <small>设计一个关卡：输入“棋盘行数.棋盘列数.棋盘情况(空为0, 有为1)”，点击“转换”，将会转换成关卡代码，可以复制下来，发给朋友。<br>
    使用关卡代码：输入关卡代码，点击“确定”。<br><br>
        例，棋盘情况：<table class="x_table shuzhi"><tr><td id="a_1_1" class="b1"></td><td id="a_1_2" class="b0"></td></tr><tr><td id="a_2_1" class="b0"></td><td id="a_2_2" class="b1"></td></tr></table>
        将黑色部分写为“1”，空白处写为“0”，就可以写作“1001”。<br>
        加上棋盘的行和列就是“2.2.1001”。<br>
        输入并转换后，得到代码“2.2.M”。
</small>
</div>



<div id="菜单1" style="display:none;">
    <table class="caidan x_table shuzhi"><tr>
        <td class="b0" id="手0" onclick="手=2;document.getElementById('手0').style='color:#000000';document.getElementById('手1').style='background-color:#aaaaaa';" style="color:#aaaaaa">✖︎</td>
        <td class="b1" id="手1" onclick="手=1;document.getElementById('手0').style='color:#aaaaaa';document.getElementById('手1').style='background-color:#000000';" style="background-color:#000000"></td>
    </tr></table>
    <a onclick="重新开始()">重新开始</a>　<a onclick="选择关卡()">选择关卡</a>
</div>

<br>

<small>当前关卡：</small><span id="当前关卡">无</span><br>

<div id="测试菜单" style="display:none;"></div>

<textArea id="复制" style="position:absolute;top:-1000px"></textArea><script>let 制;function 复(){制=制.replace(/［换行］/g, "\n");notyf.confirm("已复制");document.getElementById('复制').value = 制;let 复制 = document.querySelector('#复制');复制.select();document.execCommand("Copy");}</script>


<script>
    let 关={
        1:[3,3,"000010000"],
        2:[3,3,"000111000"],
        3:[3,3,"001000100"],
        4:[4,4,"1111111011001000"],
        5:[4,4,"0110110110110110"],
        6:[3,3,"101011110"],
        7:[5,5,"1101110101011101010111011"],
        8:[5,5,"0010001010101010101000100"],
        9:[5,5,"1101110101011101010111011"],
        10:[5,5,"0101011011001001101101010"],
        11:[5,5,"0010001110111110111000100"],
        12:[5,5,"0000100011001010100111111"],
        13:[5,5,"1110000100000111101111001"],
        14:[5,5,"1010101010100010101001110"],
        15:[5,5,"0101010101101011000110001"],
        16:[4,5,"01101001111110011001"],
        17:[4,5,"01101001100110010110"],
        18:[5,6,"011001001010010101100111000001"],
        19:[3,5,"111010010010111"],
        20:[4,5,"10011001100110010110"],
        21:[5,5,"1111110001100011000111111"],
        22:[5,5,"0010011111101011111100100"],
        23:[5,5,"1111100100011100010011111"],
        24:[9,9,"000010000001010000001111100010010000000010000111111111000010000000010000000010000"],
        25:[10,10,"0000001000000000100000001111111110101001101010100111101011010000100001000010000100001000110000100001"],
        26:[10,10,"0000111000000110110000010001100001000110011100010010110011001001011000011001000100000110100000001110"],
        27:[10,10,"0001111100001100011001100000110101100001010100111110000001111110001111001100011000100001000011100100"],
        28:[10,10,"0101001010110011001100110011001010110101010100101001010010101010110101001100110011001100110101001010"],
        29:[10,10,"0001100000000110001100000011000110010111111100010100000001000001110100001000111001000000010111111111"],
        30:[10,10,"0001111111000111111100000011110000011111011011101101111100110011100011011111000011101100001100000000"],
        31:[10,10,"0000001010000000111000000110010000010101011101001011001101001011010100101001010001011001001111111000"],
        32:[10,10,"1111001111100111000110100001010100000001011001001001000000111011100011100100011101000111100011111000"],
        33:[10,10,"0111100000100001000010101011001010000100110000010000011110000010000000101011001110100111101110110011"],
        34:[10,10,"0001111000001100110001100000101101000000100100011001100010010000001011010000011000110011000001111000"],
        35:[10,10,"0000110000000011000000001100000010110100001011010001111111101111111111000011000000001100000001111000"],
        36:[10,10,"0111000000100010111010001100011000110001011101000110001011101000110001100011000101110100010000001110"],
        37:[10,10,"0111000000100010111000001100010000110001011101000100001011100000110001100011000101110100010000001110"],
        38:[10,10,"0111110000010000111101001010010111001001100011010110101100011001001110100101001011110000100000111110"],
        39:[10,10,"0011000000011010000011001000000011110000001001100000110011000001100110000011111100000100000000100000"],
        40:[11,12,"0011011000001001001000010010010000100100100010000000100101001001001010010011010000000101010000010110010100100100111111110"],
    }

let 关卡={
    "教学关":["玩玩就会了。",1,2,3,4,5,6,7,
    ],"非常简单":["",8,9,10,11,
    ],"简单":["",12,13,14,
    ],"字符":["",15,16,17,18,19,20,21,22,23,24,25,

    ],
    "测试":["我做新关卡测试用的，直接点取消吧。",
    26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,

/*


*/



        // [,,""],
        // [,,""],
    ],
}

let 棋盘,棋盘a,棋盘b,当前,答案,答案a,答案b,答案c,手=1,胜利,关卡模式,正确,答卷;

function 打印(a,b,c){//a横 b竖 c模式(数字为黑色数量随机)("关卡名_关卡数字")
    document.getElementById("菜单0").style="display:none;";
    document.getElementById("菜单01").style="display:none;";
    document.getElementById("菜单02").style="display:none;";
    document.getElementById("菜单03").style="display:none;";
    document.getElementById("菜单选关").style="display:none;";
    document.getElementById("菜单1").style="";
    答案={},答案a={},答案b={},答案c=0,棋盘=[],棋盘a=a,棋盘b=b,当前={},胜利=0,正确=0,答卷=0;
    if(c>0){//黑色数量，随机出棋盘
        for(let i=0;a*b>i;i++){
            if(c*1>i){棋盘[棋盘.length]=1}else{棋盘[棋盘.length]=0}
        }
        arr=棋盘;
        随机();
        棋盘=arr;
        关卡模式=c;
        document.getElementById("当前关卡").innerHTML="随机"+a+"✖︎"+b+" <small><a onclick='分享()'>分享</a></small>";
    }else{//有图的棋盘
        c=c.split("_");//0_地图xxx(重新开始) 1_地图xxx(导入) 关卡名_关卡数字
        if(c[0]!="0"){关卡模式=c.join("_");}
        if(c[0]=="0"||c[0]=="1"){棋盘=c[1].split("");}
        else{棋盘=关[关卡[c[0]][c[1]]][2].split("");}

        if(c[0]=="1"){document.getElementById("当前关卡").innerHTML="自定义关卡 <small><a onclick='分享()'>分享</a></small>";}
        else if(c[0]!="0"){document.getElementById("当前关卡").innerHTML=c[0]+" 第"+c[1]+"关 <small><a onclick='分享()'>分享</a></small>";}
        
    }
    
    let dy="<div id='恭喜胜利' style='display:none;'><h3>恭喜胜利</h3>";
    if(关卡模式>0){dy+="<a onclick='打印("+a+","+b+","+c+")' class='anniu'>再来一局</a>"}
    else if(关卡模式[0]=="1"){}
    
    else{
        let 临时=关卡模式.split("_");
        if(关卡[临时[0]].length-1>临时[1]){

            临时[1]=临时[1]*1+1;
            dy+="<a onclick=\"打印("+关[关卡[临时[0]][临时[1]]][0]+","+关[关卡[临时[0]][临时[1]]][1]+",'"+临时[0]+"_"+临时[1]+"')\" class='anniu'>下一关</a>"
            document.getElementById("测试菜单").innerHTML="<a onclick=\"打印("+关[关卡[临时[0]][临时[1]]][0]+","+关[关卡[临时[0]][临时[1]]][1]+",'"+临时[0]+"_"+临时[1]+"')\" class='anniu'>下一关</a>";

        }else{dy+="已通关　<a onclick='选择关卡()'>重新选择关卡</a>";document.getElementById("测试菜单").innerHTML="没了";}
    }
    dy+="<hr></div>";

    dy+="<table class='x_table shuzhi'><tr>";
    for(let i=0;a*1+1>i;i++){
        dy+="<td id='a_0_"+i+"' class='b'></td>";
    }

    for(let i=0;b>i;i++){
        dy+="<tr>";
            答案[i+1]=[0];
            当前[i+1]=[0];
            for(let j=0;a>j;j++){
                if(j==0){dy+="<td id='a_"+(i+1)+"_0' class='b'></td>";}
                dy+="<td id='a_"+(i+1)+"_"+(j+1)+"' onclick=\"按("+(i+1)+","+(j+1)+")\" class='b0 da"+棋盘[a*i+j]+"'></td>";

                if(!答案a[i+1]){答案a[i+1]=[0]}if(棋盘[a*i+j]==0&&答案a[i+1][答案a[i+1].length-1]!=0){答案a[i+1][答案a[i+1].length]=0}else if(棋盘[a*i+j]==1){答案a[i+1][答案a[i+1].length-1]+=1;答案c+=1;}

                if(!答案b[j+1]){答案b[j+1]=[0]}if(棋盘[a*i+j]==0&&答案b[j+1][答案b[j+1].length-1]!=0){答案b[j+1][答案b[j+1].length]=0}else if(棋盘[a*i+j]==1){答案b[j+1][答案b[j+1].length-1]+=1;}

                答案[i+1][j+1]=棋盘[a*i+j];
                当前[i+1][j+1]=0;
            }
        dy+="</tr>";
    }
    dy+="</table>";
    document.getElementById("dy").innerHTML=dy;

    for(let i=0;b>i;i++){
        let 临时="";
        for(let j=0;答案a[i+1].length>j;j++){
            if(答案a[i+1][j]!=0){if(临时!=""){临时+=" "}临时+=答案a[i+1][j]}
        }
        答案[i+1][0]=临时;
        if(临时==""){正确+=1;document.getElementById("a_"+(i+1)+"_0").className="fuhe"}
        答卷+=1;
        document.getElementById("a_"+(i+1)+"_0").innerHTML=临时;
    }
    答案[0]=[0];
    for(let i=0;a>i;i++){
        let 临时="";
        for(let j=0;答案b[i+1].length>j;j++){
            if(答案b[i+1][j]!=0){if(临时!=""){临时+=" "}临时+=答案b[i+1][j]}
        }
        答案[0][i+1]=临时;
        if(临时==""){正确+=1;document.getElementById("a_0_"+(i+1)).className="fuhe"}
        答卷+=1;
        document.getElementById("a_0_"+(i+1)).innerHTML=临时.replace(new RegExp(' ',"g"),"<br>");
    }
}

function 按(a,b){
    if(当前[a][b]==0){//当前为空
        if(手==1){
            当前[a][b]=1;document.getElementById("a_"+a+"_"+b).className="b1";
        }else{当前[a][b]=2;document.getElementById("a_"+a+"_"+b).className="b0";document.getElementById("a_"+a+"_"+b).innerHTML="✖︎";}
    }else if(当前[a][b]==1){//当前有
        if(手==1){当前[a][b]=0;document.getElementById("a_"+a+"_"+b).className="b0";
        }else{当前[a][b]=2;document.getElementById("a_"+a+"_"+b).className="b0";document.getElementById("a_"+a+"_"+b).innerHTML="✖︎";}
    }else{//当前为×
        if(手==1){
            当前[a][b]=1;document.getElementById("a_"+a+"_"+b).className="b1";document.getElementById("a_"+a+"_"+b).innerHTML="";
        }else{当前[a][b]=0;document.getElementById("a_"+a+"_"+b).innerHTML="";}
    }

    let 临时=[0];
    for(let i=0;棋盘a>i;i++){
        if(当前[a][i+1]==1){临时[临时.length-1]+=1}else if(临时[临时.length-1]!=0){临时[临时.length]=0;}
    }
    临时=临时.filter(item=>item!==0);

    if(临时.join(" ")==答案[a][0]&&document.getElementById("a_"+a+"_0").className=="b"){
        document.getElementById("a_"+a+"_0").className="fuhe";
        正确+=1;
    }else if(临时.join(" ")!=答案[a][0]&&document.getElementById("a_"+a+"_0").className=="fuhe"){document.getElementById("a_"+a+"_0").className="b";正确-=1;}

    临时=[0];
    for(let i=0;棋盘b>i;i++){
        if(当前[i+1][b]==1){
            临时[临时.length-1]+=1}else if(临时[临时.length-1]!=0){临时[临时.length]=0;}
    }
    临时=临时.filter(item=>item!==0);

    if(临时.join(" ")==答案[0][b]&&document.getElementById("a_0_"+b).className=="b"){
        document.getElementById("a_0_"+b).className="fuhe";
        正确+=1;
    }else if(临时.join(" ")!=答案[0][b]&&document.getElementById("a_0_"+b).className=="fuhe"){document.getElementById("a_0_"+b).className="b";正确-=1;}

    if(胜利==0&&答卷==正确){
        胜利=1;document.getElementById("恭喜胜利").style="";
        notyf.confirm("恭喜胜利");
        let 临时=棋盘a*棋盘b-答案c;
        if(棋盘a+棋盘b>答案c){}//难度低
        else{余额(临时)}
    }
}

function 重新开始(){
    打印(棋盘a,棋盘b,"0_"+棋盘.join(''));
}

function 自选(a,b,c){
    if(a>0&&a.indexOf(".")==-1&&b>0&&b.indexOf(".")==-1&&c>0&&c.indexOf(".")==-1){
        打印(a,b,c);
    }else{
        notyf.alert("请输入正确的数字");
    }
}

let 替换表=[["G","11111"],["p","11110"],["5","11101"],["6","11100"],["K","11011"],["W","11010"],["A","11001"],["J","11000"],["I","10111"],["h","10110"],["s","10101"],["t","10100"],["S","10011"],["q","10010"],["T","10001"],["L","10000"],["H","01111"],["j","01110"],["C","01101"],["Y","01100"],["m","01011"],["F","01010"],["B","01001"],["V","01000"],["r","00111"],["a","00110"],["i","00101"],["U","00100"],["w","00011"],["E","00010"],["2","00001"],["R","00000"],["4","1111"],["d","1110"],["f","1101"],["o","1100"],["3","1011"],["u","1010"],["M","1001"],["g","1000"],["z","0111"],["O","0110"],["y","0101"],["b","0100"],["P","0011"],["9","0010"],["8","0001"],["x","0000"],["Q","111"],["c","110"],["l","101"],["k","100"],["e","011"],["X","010"],["7","001"],["Z","000"],["N","11"],["D","10"],["n","01"],["v","00"],["-","1"],["1","0"],["0","-"]]


function 导入(a){
    if(a=="测试"){
        document.getElementById("测试").innerHTML=".da1{background-color:#000000;}.b1{background-color:#04e813;}";
        document.getElementById("测试菜单").style="";
        document.getElementById('菜单03').style='display:none;';document.getElementById('菜单0').style=''
    }else if(a>0){
        打印(关[a][0],关[a][1],"1_"+关[a][2]);
    }else{
        a=a.split(".");
        for(let i=替换表.length-1;i>0;i--){
            a[2]=a[2].replace(new RegExp(替换表[i][0],"g"),替换表[i][1])
        }
        打印(a[0],a[1],"1_"+a[2]);
    }

}
function 转换(a){
    a=a.split(".");
    for(let i=0;替换表.length>i;i++){
        a[2]=a[2].replace(new RegExp(替换表[i][1],"g"),替换表[i][0])
    }
    document.getElementById("导入").value=a.join(".");
}

function 选关(a){
    document.getElementById("菜单01").style="display:none;";
    document.getElementById("菜单选关").style="";
    let dy="<h3 style='display:inline;'>"+a+"</h3> <a onclick=\"document.getElementById('菜单选关').style='display:none;';document.getElementById('菜单0').style=''\">取消</a><br>"+关卡[a][0]+"<br><br>";
    for(let i=1;关卡[a].length>i;i++){
        dy+="<span class='xuanguan' onclick=\"打印("+关[关卡[a][i]][0]+","+关[关卡[a][i]][1]+",'"+a+"_"+i+"')\">"+i+"</span>"
        if(i%5==0){dy+="<br>"}
    }
    document.getElementById("菜单选关").innerHTML=dy;
}

function 选择关卡(){
    document.getElementById('菜单1').style='display:none;';document.getElementById('菜单0').style='';document.getElementById('dy').innerHTML='';document.getElementById('当前关卡').innerHTML='无';
    document.getElementById("测试菜单").innerHTML="";
}

let url=window.location.href;
if(url.indexOf("?")!=-1){
导入(url.split("?")[1].split("#")[0])
}

function 分享(){
    let dy=棋盘.join('');
    for(let i=0;替换表.length>i;i++){
        dy=dy.replace(new RegExp(替换表[i][1],"g"),替换表[i][0]);
    }
    dy=棋盘a+"."+棋盘b+"."+dy;
    url=url.split("?")[0].split("#")[0];
    复(制=url+"?"+dy)
}

</script>

